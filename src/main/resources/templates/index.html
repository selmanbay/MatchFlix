<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Matchflix</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<header>
    <h2 class="logo">Matchflix</h2>
    <div class="header-buttons">
        <button>Kaydolma</button>
        <button>GiriÅŸ Yap</button>
    </div>
</header>

<!-- YÄ±ldÄ±z arka planÄ± -->
<canvas id="stars"></canvas>

<div class="container">
    <form id="movieForm" action="/add" method="post">
        <div class="autocomplete">
            <input type="text" id="movieInput" name="title" placeholder="Film adÄ±" autocomplete="off" required>
            <ul id="suggestions"></ul>
        </div>
        <button type="submit" class="add">+ Film Ekle</button>
    </form>
</div>

<div class="category-section">
    <div class="category-title">ðŸ”¥ Aksiyon</div>
    <div class="carousel" id="carousel">
        <!-- BaÅŸlangÄ±Ã§ta boÅŸ olabilir -->
    </div>
</div>

<script src="/stars.js"></script>
<script>
    const form = document.getElementById("movieForm");
    const input = document.getElementById("movieInput");
    const carousel = document.getElementById("carousel");
    const suggestionBox = document.getElementById("suggestions");

    // Film ekleme
    form.addEventListener("submit", async function (e) {
        e.preventDefault();
        const title = input.value.trim();
        if (!title) return;

        const formData = new FormData(form);
        await fetch("/add", {
            method: "POST",
            body: formData
        });

        // Yeni kart oluÅŸtur ve carousele ekle
        const newCard = document.createElement("div");
        newCard.classList.add("film-card", "filled");
        newCard.textContent = title;
        carousel.appendChild(newCard);

        input.value = "";
        suggestionBox.style.display = "none";
    });

    // Suggestion menÃ¼sÃ¼
    input.addEventListener("input", async function () {
        const query = this.value.trim();
        if (query.length >= 1) {
            suggestionBox.style.display = "block";
            suggestionBox.innerHTML = "<li>Ã–neriler yÃ¼kleniyor...</li>";

            try {
                const response = await fetch(`/suggest?query=${query}`);
                if (response.ok) {
                    const suggestions = await response.json();
                    suggestionBox.innerHTML = "";
                    if (suggestions.length === 0) {
                        suggestionBox.innerHTML = "<li>SonuÃ§ bulunamadÄ±</li>";
                    } else {
                        suggestions.forEach(title => {
                            const li = document.createElement("li");
                            li.textContent = title;
                            li.onclick = () => {
                                input.value = title;
                                suggestionBox.style.display = "none";
                            };
                            suggestionBox.appendChild(li);
                        });
                    }
                }
            } catch {
                suggestionBox.innerHTML = "<li>Sunucuya baÄŸlanÄ±lamadÄ±</li>";
            }
        } else {
            suggestionBox.style.display = "none";
        }
    });
</script>
</body>
</html>
