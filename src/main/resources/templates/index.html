<!DOCTYPE html>
<html lang="tr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Matchflix</title>
    <link rel="stylesheet" href="/style.css">
    <!-- Bootstrap ekleyelim -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header class="d-flex justify-content-between align-items-center p-3 bg-dark text-white">
    <h2 class="logo">Matchflix</h2>
    <div class="header-buttons">
        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#registerModal">KayÄ±t Ol</button>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#loginModal">GiriÅŸ</button>
    </div>
</header>

<!-- YÄ±ldÄ±z arka planÄ± -->
<canvas id="stars"></canvas>

<div class="container mt-4">
    <form id="movieForm" action="/add" method="post">
        <div class="autocomplete mb-3">
            <input type="text" id="movieInput" name="title" placeholder="Film adÄ±" autocomplete="off" class="form-control" required>
            <ul id="suggestions" class="list-group"></ul>
        </div>
        <button type="submit" class="btn btn-warning">+ Film Ekle</button>
    </form>
</div>

<div class="category-section mt-5">
    <div class="category-title h4">ðŸ”¥ Aksiyon</div>
    <div class="carousel d-flex gap-2 flex-wrap" id="carousel">
        <!-- Kartlar buraya eklenecek -->
    </div>
</div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content p-4">
            <h4>KayÄ±t Ol</h4>
            <form th:action="@{/users/add}" method="post">
                <div class="mb-3">
                    <label>Email</label>
                    <input type="email" name="email" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>KullanÄ±cÄ± AdÄ±</label>
                    <input type="text" name="username" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Åžifre</label>
                    <input type="password" name="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">KayÄ±t Ol</button>
            </form>
        </div>
    </div>
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content p-4">
            <h4>GiriÅŸ Yap</h4>
            <form th:action="@{/users/login}" method="post">
                <div class="mb-3">
                    <label>Email</label>
                    <input type="email" name="email" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Åžifre</label>
                    <input type="password" name="password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success">GiriÅŸ</button>
            </form>
        </div>
    </div>
</div>

<script src="/stars.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const form = document.getElementById("movieForm");
    const input = document.getElementById("movieInput");
    const carousel = document.getElementById("carousel");
    const suggestionBox = document.getElementById("suggestions");

    // Film ekleme
    form.addEventListener("submit", async function (e) {
        e.preventDefault();
        const title = input.value.trim();
        if (!title) return;

        const formData = new FormData(form);
        await fetch("/add", {
            method: "POST",
            body: formData
        });

        // Yeni kart oluÅŸtur ve carousele ekle
        const newCard = document.createElement("div");
        newCard.classList.add("film-card", "filled", "p-2", "border", "rounded");
        newCard.textContent = title;
        carousel.appendChild(newCard);

        input.value = "";
        suggestionBox.style.display = "none";
    });

    // Suggestion menÃ¼sÃ¼
    input.addEventListener("input", async function () {
        const query = this.value.trim();
        if (query.length >= 1) {
            suggestionBox.style.display = "block";
            suggestionBox.innerHTML = "<li class='list-group-item'>Ã–neriler yÃ¼kleniyor...</li>";

            try {
                const response = await fetch(`/suggest?query=${query}`);
                if (response.ok) {
                    const suggestions = await response.json();
                    suggestionBox.innerHTML = "";
                    if (suggestions.length === 0) {
                        suggestionBox.innerHTML = "<li class='list-group-item'>SonuÃ§ bulunamadÄ±</li>";
                    } else {
                        suggestions.forEach(title => {
                            const li = document.createElement("li");
                            li.textContent = title;
                            li.classList.add("list-group-item");
                            li.onclick = () => {
                                input.value = title;
                                suggestionBox.style.display = "none";
                            };
                            suggestionBox.appendChild(li);
                        });
                    }
                }
            } catch {
                suggestionBox.innerHTML = "<li class='list-group-item'>Sunucuya baÄŸlanÄ±lamadÄ±</li>";
            }
        } else {
            suggestionBox.style.display = "none";
        }
    });
</script>
</body>
</html>
